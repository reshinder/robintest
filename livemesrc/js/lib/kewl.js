/**
 * Live.me
 * KEWL Hybrid Development JavaScript API
 * 
 * Author: Leo <liyang5@cmcm.com>
 * Date: 2017-03-09 11:10:53
 * 
 * Git: http://git.liebaopay.com/UX-FED-PC/liveme-h5-api
 *
 */

!function(e,t){"use strict";var n,o=e.Base64,r="2.1.9";if("undefined"!=typeof module&&module.exports)try{n=require("buffer").Buffer}catch(e){}var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=function(e){for(var t={},n=0,o=e.length;n<o;n++)t[e.charAt(n)]=n;return t}(a),s=String.fromCharCode,p=function(e){if(e.length<2){var t=e.charCodeAt(0);return t<128?e:t<2048?s(192|t>>>6)+s(128|63&t):s(224|t>>>12&15)+s(128|t>>>6&63)+s(128|63&t)}var t=65536+1024*(e.charCodeAt(0)-55296)+(e.charCodeAt(1)-56320);return s(240|t>>>18&7)+s(128|t>>>12&63)+s(128|t>>>6&63)+s(128|63&t)},c=/[\uD800-\uDBFF][\uDC00-\uDFFFF]|[^\x00-\x7F]/g,u=function(e){return e.replace(c,p)},f=function(e){var t=[0,2,1][e.length%3],n=e.charCodeAt(0)<<16|(e.length>1?e.charCodeAt(1):0)<<8|(e.length>2?e.charCodeAt(2):0),o=[a.charAt(n>>>18),a.charAt(n>>>12&63),t>=2?"=":a.charAt(n>>>6&63),t>=1?"=":a.charAt(63&n)];return o.join("")},g=e.btoa?function(t){return e.btoa(t)}:function(e){return e.replace(/[\s\S]{1,3}/g,f)},h=n?function(e){return(e.constructor===n.constructor?e:new n(e)).toString("base64")}:function(e){return g(u(e))},l=function(e,t){return t?h(String(e)).replace(/[+\/]/g,function(e){return"+"==e?"-":"_"}).replace(/=/g,""):h(String(e))},d=function(e){return l(e,!0)},y=new RegExp(["[À-ß][-¿]","[à-ï][-¿]{2}","[ð-÷][-¿]{3}"].join("|"),"g"),P=function(e){switch(e.length){case 4:var t=(7&e.charCodeAt(0))<<18|(63&e.charCodeAt(1))<<12|(63&e.charCodeAt(2))<<6|63&e.charCodeAt(3),n=t-65536;return s((n>>>10)+55296)+s((1023&n)+56320);case 3:return s((15&e.charCodeAt(0))<<12|(63&e.charCodeAt(1))<<6|63&e.charCodeAt(2));default:return s((31&e.charCodeAt(0))<<6|63&e.charCodeAt(1))}},v=function(e){return e.replace(y,P)},b=function(e){var t=e.length,n=t%4,o=(t>0?i[e.charAt(0)]<<18:0)|(t>1?i[e.charAt(1)]<<12:0)|(t>2?i[e.charAt(2)]<<6:0)|(t>3?i[e.charAt(3)]:0),r=[s(o>>>16),s(o>>>8&255),s(255&o)];return r.length-=[0,0,2,1][n],r.join("")},m=e.atob?function(t){return e.atob(t)}:function(e){return e.replace(/[\s\S]{1,4}/g,b)},w=n?function(e){return(e.constructor===n.constructor?e:new n(e,"base64")).toString()}:function(e){return v(m(e))},O=function(e){return w(String(e).replace(/[-_]/g,function(e){return"-"==e?"+":"/"}).replace(/[^A-Za-z0-9\+\/]/g,""))},A=function(){var t=e.Base64;return e.Base64=o,t};if(e.Base64={VERSION:r,atob:m,btoa:g,fromBase64:O,toBase64:l,utob:u,encode:l,encodeURI:d,btou:v,decode:O,noConflict:A},"function"==typeof Object.defineProperty){var C=function(e){return{value:e,enumerable:!1,writable:!0,configurable:!0}};e.Base64.extendString=function(){Object.defineProperty(String.prototype,"fromBase64",C(function(){return O(this)})),Object.defineProperty(String.prototype,"toBase64",C(function(e){return l(this,e)})),Object.defineProperty(String.prototype,"toBase64URI",C(function(){return l(this,!0)}))}}e.Meteor&&(Base64=e.Base64)}(window),function(e,t){"use strict";function n(t){var n="cmlive"+(new Date).getTime()+Math.random().toString().substr(2);return e[n]=function(o){var r="string"==typeof o?JSON.parse(o):o;t&&t(r),delete e[n]},n}function o(){if(f&&!c&&"object"==typeof g&&g.hasOwnProperty("getVerCode"))return g.getVerCode("");if(f&&c){var e=a.match(/live\.me-iOS\/(.+)/i);if(e&&e.length>1){var t=e[1].split("."),n=0;return n+=t[0]?1e7*parseInt(t[0]):0,n+=t[1]?1e5*parseInt(t[1]):0,n+=t[2]?1e4*parseInt(t[2]):0,n+=t[3]?parseInt(t[3]):0}}return 0}var r=e.document,a=e.navigator.userAgent,i=/Android|HTC/i.test(a),s=!i&&/iPad/i.test(a),p=!i&&/iPod|iPhone/i.test(a),c=s||p,u="object"==typeof e.webkit&&!!e.webkit.messageHandlers&&!!e.webkit.messageHandlers.webViewApp&&!!e.webkit.messageHandlers.webViewApp.postMessage&&"function"==typeof e.webkit.messageHandlers.webViewApp.postMessage,f=i&&"object"==typeof e.android&&e.android.hasOwnProperty("openBoZhuPage")||!!u||/live\.me-ios/i.test(a),g=f&&"object"==typeof e.android?e.android:null,h="cmlive://",l={tryOpen:function(t){if(t||""===t){if(t=h+t,c)return void(e.location.href=t);var n=r.createElement("iframe");n.style.cssText="width:1px;height:1px;position:fixed;top:0;left:0;",n.src=t,r.body.appendChild(n),setTimeout(function(){r.body.removeChild(n)},10)}},iosPostMessage:function(t){u&&"object"==typeof t&&e.webkit.messageHandlers.webViewApp.postMessage(t)},openApp:function(){f||this.tryOpen("")},openLivePage:function(e){if(e=e||"",f&&!c)g.openLivePage(""+e);else if(u)try{this.iosPostMessage({type:"openlivepage",id:""+e})}catch(e){}else this.tryOpen("openlivepage?id="+e)},openReplayPage:function(e){if(e=e||"",f&&!c)this.getVerCode()<30080500?this.openLivePage(e):g.openReplayPage(""+e);else if(u)try{this.iosPostMessage({type:"openlivepage",id:""+e})}catch(e){}else this.tryOpen("openreplaypage?id="+e)},openBoZhuPage:function(e){e&&(f&&!c?g.openBoZhuPage(""+e):u?this.iosPostMessage({type:"openbozhupage",id:""+e}):this.tryOpen("openbozhupage?id="+e))},openHomePage:function(){f&&!c?g.openHomePage(""):u?this.iosPostMessage({type:"openhomepage"}):this.tryOpen("openhomepage")},openPersonalPage:function(){f&&!c?g.openPersonalPage():u?this.iosPostMessage({type:"openpersonalpage"}):this.tryOpen("openpersonalpage")},openTaskListPage:function(){f&&!c?g.openTaskListPage():this.tryOpen("opentasklistpage")},openCashPage:function(){f&&!c?g.openCashPage(""):this.tryOpen("opencashpage")},openPrepareLivePage:function(){if(f&&!c)if(0===arguments.length||1===arguments.length&&""===arguments[0])g.openPrepareLivePage();else{var e=Array.prototype.slice.call(arguments);if(e.length<3)for(var t=0,n=3-e.length;t<n;t++)e.push("");else e.length=3;g.openPrepareLivePage.apply(g,e)()}else u?this.iosPostMessage({type:"openpreparelivepage"}):this.tryOpen("openpreparelivepage")},openIntroduceBroadcasterPage:function(){f&&!c?g.openIntroduceBroadcasterPage(""):this.tryOpen("openintroducebroadcasterpage")},openwebview:function(e){!f&&Base64&&this.tryOpen("openwebview?url="+Base64.encode(e))},androidTryOpenAppOrDownload:function(e){var t=this;setTimeout(function(){var n=(new Date).valueOf();e&&e.id?t.openLivePage(e.id):e.other&&t[e.other.fn]?t[e.other.fn].apply(t,e.other.param||[]):t.openApp(),n=(new Date).valueOf(),setTimeout(function(){var t=(new Date).valueOf();1550>t-n?e.fail&&e.fail():e.success&&e.success()},1500)},100)},openSearchTagPage:function(e){f&&!c&&e&&g&&g.openSearchTagPage&&g.openSearchTagPage("",e)},closePage:function(){f&&!c?g.closePage(""):u?this.iosPostMessage({type:"close"}):f&&c&&this.tryOpen("close")},getVerCode:function(){return o()},getVerName:function(){if(f&&!c&&"object"==typeof g&&g.hasOwnProperty("getVerName"))return g.getVerName("");if(f&&c){var e=a.match(/live\.me-iOS\/(.+)/i);if(e&&e.length>1)return e[1]}return""},setTitle:function(e){e&&"string"==typeof e&&(Base64&&f&&!c&&this.getVerCode()>=209e5?g.changeTitle(Base64.encode(e)):Base64&&f&&c&&this.getVerCode()>=1031e5?this.tryOpen("changeTitle?title="+Base64.encode(e)):Base64&&u?this.iosPostMessage({type:"changetitle",title:Base64.encode(e)}):document.title=e)},getUserInfo:function(e){var t;if(f&&!c&&"object"==typeof g&&g.hasOwnProperty("getUserInfo"))t=g.getUserInfo(""),t="string"==typeof t&&"null"!==t&&""!==t?JSON.parse(t):t,e&&e(t);else if(f&&c&&this.getVerCode()>=104e5){var o=n(e);u?this.iosPostMessage({type:"getuserinfo",callback:o}):this.tryOpen("getuserinfo?callback="+o)}},copy:function(e){return!!e&&(f&&!c&&"object"==typeof g&&g.hasOwnProperty("getUserInfo")?(g.copy(""+e),!0):!!u&&(this.iosPostMessage({type:"copy",text:""+e}),!0))},hasShare:function(){return f&&!c&&"object"==typeof g&&g.hasOwnProperty("openShareMenu")||f&&c&&o()>=108e5}(),openShareMenu:function(e,t){var o={shareTypes:"0",url:window.location.href,content:document.querySelector('meta[name="description"]').content,image:"http://www.liveme.com/images/logo.jpg",subject:document.title};if("object"==typeof e){for(var r in o)e.hasOwnProperty(r)&&(o[r]=e[r]);o.callback=n(t),this.hasShare&&!c?g.openShareMenu(JSON.stringify(o)):this.hasShare&&c&&(o.type="openShareMenu",this.iosPostMessage(o))}},openInBrowser:function(e){f&&c&&o()>=2e7?this.iosPostMessage({type:"openurl",url:Base64.encode(""+e)}):window.location.href=""+e},openRechargePage:function(){return f&&!c&&"object"==typeof g&&g.hasOwnProperty("openRechargePage")?(g.openRechargePage(""),!0):u?(this.iosPostMessage({type:"openrechargepage"}),!0):void this.tryOpen("openRechargePage")}};Object.defineProperties(l,{isKEWLApp:{get:function(){return f}}}),f&&document.addEventListener("DOMContentLoaded",function(){l.setTitle(document.title)},!1),"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(function(){return l}):"undefined"!=typeof module&&module.exports?module.exports.KEWLApp=l:e.KEWLApp=l}(window);